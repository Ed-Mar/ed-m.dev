<!doctype html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="ie=edge">
<link rel=stylesheet href=https://ed-m.dev/css/style.css>
<link rel=stylesheet href=https://ed-m.dev/css/single-page.css>
<title>Saga Runner | 220801</title>
</head>
<body>
<nav class=navBar>
<ul>
<a href=/>
Ed-M.Dev
</a>
<a href=/notes>
Notes
</a>
<a href=/about>
About
</a>
</ul>
</nav>
<div class="main container single">
<div class=single-page-content-container>
<div class=single-page-header>
<h2>Saga Runner | 220801</h2>
<time>Mon, Aug 1, 2022</time>
<div class=single-page-project>
<h3><a href=/notes/projects/conduit> Project - Conduit</a></h3>
</div>
<div class=tags-container>
<div class=tag-list-item>
<a href=/tags/saga>Saga</a>
</div>
<div class=tag-list-item>
<a href=/tags/microservices>Microservices</a>
</div>
<div class=tag-list-item>
<a href=/tags/go>Go</a>
</div>
<div class=tag-list-item>
<a href=/tags/devblog>Devblog</a>
</div>
</div>
</div>
<br>
<div class=single-page-content>
<h1 id=220801>220801</h1>
<h2 id=saga-runner>Saga Runner</h2>
<p>I am working on getting the saga its list of commands to execute.
I made some notes to help me with error handling</p>
<div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#999;font-style:italic>/*  
</span><span style=color:#999;font-style:italic> Order of Transaction is import in passed ListOfTransactions
</span><span style=color:#999;font-style:italic>	 - Compensatable Transactions:
</span><span style=color:#999;font-style:italic>	  -- NOTE: Compensatable Transactions should have two Transaction Commands. The first one for the intended Transaction and the second one to Roll back that Transaction encase of failure/issues in any of the following Transaction. Its okay if th Compensatable does not have an Second Transaction Action Command. I think I will try and use a an empty Transaction Command to keep the logic simple in this implenatation 
</span><span style=color:#999;font-style:italic>	  -- Can only be in place prior in order to the Pivot Transaction and never after 
</span><span style=color:#999;font-style:italic>	  -- If there is no Pivot Transaction Action then there cannot be any Compensatable Transactions 
</span><span style=color:#999;font-style:italic>	- Pivot Transaction: 
</span><span style=color:#999;font-style:italic>	  -- There can only be one per list of Transactions or 
</span><span style=color:#999;font-style:italic>	- Retryable Transactions: 
</span><span style=color:#999;font-style:italic>	  -- If the Pivot Transaction exist in the List then Retryable Transactions can only be in after that Pivot Transaction
</span><span style=color:#999;font-style:italic>	  -- Retryable Transactions should never be in the list of Transactions prior to the Pivot Transaction if it exists  
</span><span style=color:#999;font-style:italic>	  
</span><span style=color:#999;font-style:italic> - NOTE Other Use Cases:
</span><span style=color:#999;font-style:italic>    -- You can have a Pivot Transaction without Compensatable Transaction(s) 
</span><span style=color:#999;font-style:italic>    -- You can just have list of Transactions without Pivot nor Compensatable Transactions(So just Retryable Transactions (Granted idk why you would tho))
</span><span style=color:#999;font-style:italic>*/</span>
</code></pre></div><p><em>_1404</em>
So working on the Execution of the saga I was trying check the list of the transactions to confirm that it sticking to the Saga Pattern at the same time of Execution. I was doing this to keep the Big O notation on the smaller side if possible, but am running into an issue where I could execute some of the transactions then near the end of the Saga List&rsquo;s of Transaction and find an issue with logically with it. Which shouldn&rsquo;t be and issue per say cause the ones that change things could just Compensate. But I am trying to think of the worse case with that would that really save me time in comparison to just using a constructor for the Sagas and checking the order right there.</p>
<p>I think I going to implement a constructor to keep the code cleaner and try to limit myself from sending messed up Sages to Execute for time saving of O(n) to 2O(n) which are the same over a long enough time scale</p>
<p><em>_2046</em></p>
<div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>NewSagaOrchestrator</span>(name <span style=color:#6ab825;font-weight:700>string</span>, transactions []Transaction) (*SagaOrchestrator, <span style=color:#6ab825;font-weight:700>error</span>) {  
   <span style=color:#6ab825;font-weight:700>var</span> sagaCreationErrorPrefix = <span style=color:#ed9d13>&#34;[ERROR] [SAGA_PATTERN] &#34;</span>  
  
  so := <span style=color:#24909d>new</span>(SagaOrchestrator)  
   so.Name = name  
  
   <span style=color:#6ab825;font-weight:700>var</span> countOfCommentableTransactions = <span style=color:#3677a9>0</span>  
  <span style=color:#6ab825;font-weight:700>var</span> countOfPivotTransactions = <span style=color:#3677a9>0</span>  
  <span style=color:#6ab825;font-weight:700>var</span> countOfRetryableTransactions = <span style=color:#3677a9>0</span>  
  <span style=color:#999;font-style:italic>// Loops through the list of transactions to check for acceptable order has been passed  
</span><span style=color:#999;font-style:italic></span>  <span style=color:#6ab825;font-weight:700>for</span> _, transaction := <span style=color:#6ab825;font-weight:700>range</span> transactions {  
  
 <span style=color:#999;font-style:italic>//Checks for Compensatable Transactions  
</span><span style=color:#999;font-style:italic></span> <span style=color:#999;font-style:italic>//Ruling:
</span><span style=color:#999;font-style:italic></span>  <span style=color:#999;font-style:italic>// There cannot be a Pivot Transaction prior to any Compensatable Transaction
</span><span style=color:#999;font-style:italic></span>  <span style=color:#999;font-style:italic>// There cannot be Retryable Transactions prior to any Retryable Transactions  if transaction.GetTransactionType() == GetCompensatableTransactionType() {  
</span><span style=color:#999;font-style:italic></span>         countOfCommentableTransactions = countOfCommentableTransactions + <span style=color:#3677a9>1</span>  
  <span style=color:#999;font-style:italic>//Checking if it&#39;s before any Pivot Transactions  
</span><span style=color:#999;font-style:italic></span>  <span style=color:#6ab825;font-weight:700>if</span> countOfPivotTransactions &gt; <span style=color:#3677a9>0</span> {  
            <span style=color:#6ab825;font-weight:700>return</span> <span style=color:#6ab825;font-weight:700>nil</span>, errors.<span style=color:#447fcf>New</span>(sagaCreationErrorPrefix + <span style=color:#ed9d13>&#34;[SAGA_CREATION] [Compensatable]| Cannot put Compensatable Transactions after a Pivot Transaction&#34;</span>)  
         }  
         <span style=color:#999;font-style:italic>//Checking if it&#39;s before any Retryable Transactions  
</span><span style=color:#999;font-style:italic></span>  <span style=color:#6ab825;font-weight:700>if</span> countOfRetryableTransactions &gt; <span style=color:#3677a9>0</span> {  
            <span style=color:#6ab825;font-weight:700>return</span> <span style=color:#6ab825;font-weight:700>nil</span>, errors.<span style=color:#447fcf>New</span>(sagaCreationErrorPrefix + <span style=color:#ed9d13>&#34;[SAGA_CREATION] [Compensatable]| Cannot put Compensatable Transactions before any Retryable Transaction(s)&#34;</span>)  
         }  
      }  
  
 <span style=color:#999;font-style:italic>//Checks for Pivot Transaction  
</span><span style=color:#999;font-style:italic></span> <span style=color:#999;font-style:italic>//Ruling: 
</span><span style=color:#999;font-style:italic></span> <span style=color:#999;font-style:italic>// There cannot be more than on pivot transaction 
</span><span style=color:#999;font-style:italic></span> <span style=color:#999;font-style:italic>// There are no Retryable prior to the Pivot  if transaction.GetTransactionType() == GetPivotTransactionType() {  
</span><span style=color:#999;font-style:italic></span>         countOfPivotTransactions = countOfPivotTransactions + <span style=color:#3677a9>1</span>  
  <span style=color:#999;font-style:italic>//Checks that there is not already a Pivot Transaction in the List of Transactions  
</span><span style=color:#999;font-style:italic></span>  <span style=color:#6ab825;font-weight:700>if</span> countOfPivotTransactions &gt; <span style=color:#3677a9>1</span> {  
            <span style=color:#6ab825;font-weight:700>return</span> <span style=color:#6ab825;font-weight:700>nil</span>, errors.<span style=color:#447fcf>New</span>(sagaCreationErrorPrefix + <span style=color:#ed9d13>&#34;[SAGA_CREATION] [Pivot]| There is more than one Pivot Transaction&#34;</span>)  
         }  
         <span style=color:#999;font-style:italic>//Checks that there is not any Retryable Transactions prior in the list of Transactions  
</span><span style=color:#999;font-style:italic></span>  <span style=color:#6ab825;font-weight:700>if</span> countOfRetryableTransactions &gt; <span style=color:#3677a9>0</span> {  
            <span style=color:#6ab825;font-weight:700>return</span> <span style=color:#6ab825;font-weight:700>nil</span>, errors.<span style=color:#447fcf>New</span>(sagaCreationErrorPrefix + <span style=color:#ed9d13>&#34;[SAGA_CREATION] [Pivot]| Cannot put Pivot Transaction After Retryable Transactions&#34;</span>)  
         }  
  
      }  
<span style=color:#999;font-style:italic>//Checking Retryable  
</span><span style=color:#999;font-style:italic>//Note: currently 220801 that I do not think I need to check for anything for Retryable, cause the other two cover it. 
</span><span style=color:#999;font-style:italic>//but I will leave this code here just in case  if transaction.GetTransactionType() == GetPivotTransactionType() {  
</span><span style=color:#999;font-style:italic></span>         countOfRetryableTransactions = countOfRetryableTransactions + <span style=color:#3677a9>1</span>  
  
  }
  <span style=color:#999;font-style:italic>//Checks at last Transaction in the list  
</span><span style=color:#999;font-style:italic></span><span style=color:#6ab825;font-weight:700>if</span> index == lastIndex {  
   <span style=color:#999;font-style:italic>//Checks that there is a pivot if there is any Compensatable Transactions  
</span><span style=color:#999;font-style:italic></span>  <span style=color:#6ab825;font-weight:700>if</span> countOfPivotTransactions &lt; <span style=color:#3677a9>1</span> &amp;&amp; countOfCompensatableTransactions &gt; <span style=color:#3677a9>0</span>{  
      <span style=color:#6ab825;font-weight:700>return</span> <span style=color:#6ab825;font-weight:700>nil</span>, errors.<span style=color:#447fcf>New</span>(sagaCreationErrorPrefix + <span style=color:#ed9d13>&#34;[SAGA_CREATION] | Compensatable Transactions have not Pivot Transactions&#34;</span>)  
  
   }  
}  
  
}  
   <span style=color:#999;font-style:italic>// So it passes the checks above its good to go.   
</span><span style=color:#999;font-style:italic></span> so.Transactions = transactions  
   <span style=color:#6ab825;font-weight:700>return</span> so, <span style=color:#6ab825;font-weight:700>nil</span>  
}


</code></pre></div>
</div>
</div>
</div>
</body>
<footer><hr>Author <a href=https://ed-m.dev/about>Edward M- </a>| Framework <a href=https://gohugo.io/>Hugo</a></footer>
</html>